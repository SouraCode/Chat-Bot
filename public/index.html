<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<title>My ChatGPT</title>
	<style>
		body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 0; background: #0f172a; color: #e2e8f0; }
		.container { max-width: 860px; margin: 0 auto; padding: 24px; }
		.header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px; }
		.card { background: #111827; border: 1px solid #1f2937; border-radius: 10px; padding: 16px; }
		.messages { height: 60vh; overflow-y: auto; padding: 8px; display: flex; flex-direction: column; gap: 12px; }
		.msg { padding: 10px 12px; border-radius: 10px; max-width: 80%; white-space: pre-wrap; }
		.user { background: #1f2937; align-self: flex-end; }
		.assistant { background: #0b3b2e; border: 1px solid #134e4a; align-self: flex-start; }
		.inputrow { display: grid; grid-template-columns: 1fr auto; gap: 8px; margin-top: 12px; }
		input, button { font-size: 16px; }
		input { padding: 12px; border-radius: 8px; border: 1px solid #334155; background: #0b1220; color: #e2e8f0; }
		button { padding: 12px 16px; border-radius: 8px; border: 1px solid #334155; background: #1f2937; color: #e2e8f0; cursor: pointer; }
		button:disabled { opacity: .6; cursor: not-allowed; }
	</style>
</head>
<body>
	<div class="container">
		<div class="header">
			<h2>My ChatGPT</h2>
			<button id="newSession">New Session</button>
		</div>
		<div class="card">
			<div id="messages" class="messages"></div>
			<div class="inputrow">
				<input id="prompt" placeholder="Type your message..." />
				<button id="send">Send</button>
			</div>
		</div>
	</div>

	<script>
		const messagesEl = document.getElementById('messages');
		const inputEl = document.getElementById('prompt');
		const sendBtn = document.getElementById('send');
		const newSessionBtn = document.getElementById('newSession');

		function getSessionId() {
			let id = localStorage.getItem('sessionId');
			if (!id) {
				id = crypto.randomUUID();
				localStorage.setItem('sessionId', id);
			}
			return id;
		}

		function newSession() {
			localStorage.setItem('sessionId', crypto.randomUUID());
			messagesEl.innerHTML = '';
		}

		function addMessage(role, content) {
			const div = document.createElement('div');
			div.className = `msg ${role}`;
			div.textContent = content;
			messagesEl.appendChild(div);
			messagesEl.scrollTop = messagesEl.scrollHeight;
		}

		async function sendMessage() {
			const text = inputEl.value.trim();
			if (!text) return;
			sendBtn.disabled = true;
			inputEl.value = '';
			addMessage('user', text);
			try {
				const res = await fetch('/api/chat', {
					method: 'POST',
					headers: { 'Content-Type': 'application/json' },
					body: JSON.stringify({ sessionId: getSessionId(), message: text })
				});
				const data = await res.json();
				if (res.ok) {
					addMessage('assistant', data.reply);
				} else {
					addMessage('assistant', 'Error: ' + (data.error || 'Something went wrong'));
				}
			} catch (e) {
				addMessage('assistant', 'Network error');
			} finally {
				sendBtn.disabled = false;
				inputEl.focus();
			}
		}

		inputEl.addEventListener('keydown', (e) => {
			if (e.key === 'Enter' && !e.shiftKey) {
				e.preventDefault();
				sendMessage();
			}
		});
		sendBtn.addEventListener('click', sendMessage);
		newSessionBtn.addEventListener('click', newSession);
	</script>
</body>
</html>


